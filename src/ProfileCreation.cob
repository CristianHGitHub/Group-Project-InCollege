*> Profile Creation Module
IDENTIFICATION DIVISION.
PROGRAM-ID. PROFILE-CREATION.

DATA DIVISION.
WORKING-STORAGE SECTION.
COPY "AccountRecord.cpy".

01  PROFILE-FIELDS.
    05  PF-FIRST-NAME      PIC X(25).
    05  PF-LAST-NAME       PIC X(25).
    05  PF-UNIVERSITY      PIC X(50).
    05  PF-MAJOR           PIC X(50).
    05  PF-GRADUATION-YEAR PIC 9(4).
    05  PF-ABOUT-ME        PIC X(200).

01  VALIDATION-FLAGS.
    05  VF-FIRST-NAME      PIC X VALUE "N".
    05  VF-LAST-NAME       PIC X VALUE "N".
    05  VF-UNIVERSITY      PIC X VALUE "N".
    05  VF-MAJOR           PIC X VALUE "N".
    05  VF-GRADUATION-YEAR PIC X VALUE "N".

01  CURRENT-YEAR          PIC 9(4) VALUE 2024.
01  MIN-GRAD-YEAR         PIC 9(4) VALUE 1900.
01  MAX-GRAD-YEAR         PIC 9(4) VALUE 2100.

01  PROFILE-STATUS        PIC X VALUE "N".
01  PROFILE-RESPONSE      PIC X(100).

*> Working storage for loops
01  WS-INDEX              PIC 9.

LINKAGE SECTION.
01  L-USERNAME            PIC X(50).
01  L-PROFILE-STATUS      PIC X.
01  L-PROFILE-RESPONSE    PIC X(100).

PROCEDURE DIVISION USING L-USERNAME L-PROFILE-STATUS L-PROFILE-RESPONSE.
    MOVE "N" TO PROFILE-STATUS
    MOVE SPACES TO PROFILE-RESPONSE

    *> Initialize profile fields
    MOVE SPACES TO PF-FIRST-NAME
    MOVE SPACES TO PF-LAST-NAME
    MOVE SPACES TO PF-UNIVERSITY
    MOVE SPACES TO PF-MAJOR
    MOVE 0 TO PF-GRADUATION-YEAR
    MOVE SPACES TO PF-ABOUT-ME

    *> Initialize validation flags
    MOVE "N" TO VF-FIRST-NAME
    MOVE "N" TO VF-LAST-NAME
    MOVE "N" TO VF-UNIVERSITY
    MOVE "N" TO VF-MAJOR
    MOVE "N" TO VF-GRADUATION-YEAR

    PERFORM VALIDATE-PROFILE-FIELDS

    IF VF-FIRST-NAME = "Y" AND VF-LAST-NAME = "Y" AND
       VF-UNIVERSITY = "Y" AND VF-MAJOR = "Y" AND VF-GRADUATION-YEAR = "Y"
        MOVE "Y" TO PROFILE-STATUS
        MOVE "Profile created successfully!" TO PROFILE-RESPONSE
        PERFORM SAVE-PROFILE-TO-RECORD
    ELSE
        MOVE "Profile creation failed. Please fill all required fields." TO PROFILE-RESPONSE
    END-IF

    MOVE PROFILE-STATUS TO L-PROFILE-STATUS
    MOVE PROFILE-RESPONSE TO L-PROFILE-RESPONSE

    GOBACK.

VALIDATE-PROFILE-FIELDS.
    *> Validate First Name (Required)
    IF PF-FIRST-NAME NOT = SPACES AND PF-FIRST-NAME NOT = LOW-VALUES
        MOVE "Y" TO VF-FIRST-NAME
    END-IF

    *> Validate Last Name (Required)
    IF PF-LAST-NAME NOT = SPACES AND PF-LAST-NAME NOT = LOW-VALUES
        MOVE "Y" TO VF-LAST-NAME
    END-IF

    *> Validate University (Required)
    IF PF-UNIVERSITY NOT = SPACES AND PF-UNIVERSITY NOT = LOW-VALUES
        MOVE "Y" TO VF-UNIVERSITY
    END-IF

    *> Validate Major (Required)
    IF PF-MAJOR NOT = SPACES AND PF-MAJOR NOT = LOW-VALUES
        MOVE "Y" TO VF-MAJOR
    END-IF

    *> Validate Graduation Year (Required - 4-digit year between 1900-2100)
    IF PF-GRADUATION-YEAR >= MIN-GRAD-YEAR AND PF-GRADUATION-YEAR <= MAX-GRAD-YEAR
        MOVE "Y" TO VF-GRADUATION-YEAR
    END-IF
    EXIT PARAGRAPH.

SAVE-PROFILE-TO-RECORD.
    *> Set profile fields
    MOVE PF-FIRST-NAME TO AR-FIRST-NAME
    MOVE PF-LAST-NAME TO AR-LAST-NAME
    MOVE PF-UNIVERSITY TO AR-UNIVERSITY
    MOVE PF-MAJOR TO AR-MAJOR
    MOVE PF-GRADUATION-YEAR TO AR-GRADUATION-YEAR
    MOVE PF-ABOUT-ME TO AR-ABOUT-ME

    *> Initialize experience and education arrays
    PERFORM INITIALIZE-EXPERIENCE-ARRAY
    PERFORM INITIALIZE-EDUCATION-ARRAY

    EXIT PARAGRAPH.

INITIALIZE-EXPERIENCE-ARRAY.
    MOVE 1 TO WS-INDEX
    PERFORM UNTIL WS-INDEX > 3
        MOVE SPACES TO AR-EXP-TITLE(WS-INDEX)
        MOVE SPACES TO AR-EXP-COMPANY(WS-INDEX)
        MOVE SPACES TO AR-EXP-START-DATE(WS-INDEX)
        MOVE SPACES TO AR-EXP-END-DATE(WS-INDEX)
        MOVE SPACES TO AR-EXP-DESCRIPTION(WS-INDEX)
        ADD 1 TO WS-INDEX
    END-PERFORM
    EXIT PARAGRAPH.

INITIALIZE-EDUCATION-ARRAY.
    MOVE 1 TO WS-INDEX
    PERFORM UNTIL WS-INDEX > 3
        MOVE SPACES TO AR-EDU-SCHOOL(WS-INDEX)
        MOVE SPACES TO AR-EDU-DEGREE(WS-INDEX)
        MOVE SPACES TO AR-EDU-START-DATE(WS-INDEX)
        MOVE SPACES TO AR-EDU-END-DATE(WS-INDEX)
        MOVE 0 TO AR-EDU-GPA(WS-INDEX)
        ADD 1 TO WS-INDEX
    END-PERFORM
    EXIT PARAGRAPH.
