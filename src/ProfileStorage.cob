*> Simple Profile Storage Module
IDENTIFICATION DIVISION.
PROGRAM-ID. PROFILE-STORAGE.

ENVIRONMENT DIVISION.
INPUT-OUTPUT SECTION.
FILE-CONTROL.
    SELECT PROFILE-FILE ASSIGN TO "../data/ProfileRecords.txt"
        ORGANIZATION IS LINE SEQUENTIAL.

DATA DIVISION.
FILE SECTION.
FD PROFILE-FILE.
01 PROFILE-RECORD          PIC X(1000).

WORKING-STORAGE SECTION.
COPY "AccountRecord.cpy".

01  PROFILE-DATA-STRING    PIC X(1000).
01  EOF-PROFILE            PIC X VALUE "N".

LINKAGE SECTION.
01  L-USERNAME             PIC X(50).
01  L-PROFILE-DATA         PIC X(1000).
01  L-STATUS               PIC X.
01  L-RESPONSE             PIC X(200).

PROCEDURE DIVISION USING L-USERNAME L-PROFILE-DATA L-STATUS L-RESPONSE.
    MOVE "N" TO L-STATUS
    MOVE SPACES TO L-RESPONSE

    *> Create profile record with username and profile data
    MOVE SPACES TO PROFILE-DATA-STRING
    STRING L-USERNAME DELIMITED BY SPACE
           "|" DELIMITED BY SIZE
           L-PROFILE-DATA DELIMITED BY SIZE
           INTO PROFILE-DATA-STRING
    END-STRING

    *> Write to profile file
    OPEN EXTEND PROFILE-FILE
    WRITE PROFILE-RECORD FROM PROFILE-DATA-STRING
    CLOSE PROFILE-FILE

    MOVE "Y" TO L-STATUS
    MOVE "Profile saved successfully!" TO L-RESPONSE

    GOBACK.
