*> Profile Input Handler Module
IDENTIFICATION DIVISION.
PROGRAM-ID. PROFILE-INPUT-HANDLER.

DATA DIVISION.
WORKING-STORAGE SECTION.
COPY "AccountRecord.cpy".

01  INPUT-FIELDS.
    05  IF-FIRST-NAME      PIC X(25).
    05  IF-LAST-NAME       PIC X(25).
    05  IF-UNIVERSITY      PIC X(50).
    05  IF-MAJOR           PIC X(50).
    05  IF-GRADUATION-YEAR PIC 9(4).
    05  IF-ABOUT-ME        PIC X(200).

01  PROFILE-DATA-STRING    PIC X(500).
01  VALIDATION-STATUS     PIC X.
01  VALIDATION-RESPONSE   PIC X(200).
01  STORAGE-STATUS        PIC X.
01  STORAGE-RESPONSE      PIC X(200).

LINKAGE SECTION.
01  L-USERNAME             PIC X(50).
01  L-FIRST-NAME           PIC X(25).
01  L-LAST-NAME            PIC X(25).
01  L-UNIVERSITY           PIC X(50).
01  L-MAJOR                PIC X(50).
01  L-GRADUATION-YEAR      PIC 9(4).
01  L-ABOUT-ME             PIC X(200).
01  L-STATUS               PIC X.
01  L-RESPONSE             PIC X(200).

PROCEDURE DIVISION USING L-USERNAME L-FIRST-NAME L-LAST-NAME L-UNIVERSITY
                        L-MAJOR L-GRADUATION-YEAR L-ABOUT-ME L-STATUS L-RESPONSE.
    MOVE "N" TO L-STATUS
    MOVE SPACES TO L-RESPONSE

    *> Copy input data to working storage
    MOVE L-FIRST-NAME TO IF-FIRST-NAME
    MOVE L-LAST-NAME TO IF-LAST-NAME
    MOVE L-UNIVERSITY TO IF-UNIVERSITY
    MOVE L-MAJOR TO IF-MAJOR
    MOVE L-GRADUATION-YEAR TO IF-GRADUATION-YEAR
    MOVE L-ABOUT-ME TO IF-ABOUT-ME

    *> Create profile data string for validation
    MOVE SPACES TO PROFILE-DATA-STRING
    STRING IF-FIRST-NAME DELIMITED BY SPACE
           "|" DELIMITED BY SIZE
           IF-LAST-NAME DELIMITED BY SPACE
           "|" DELIMITED BY SIZE
           IF-UNIVERSITY DELIMITED BY SPACE
           "|" DELIMITED BY SIZE
           IF-MAJOR DELIMITED BY SPACE
           "|" DELIMITED BY SIZE
           IF-GRADUATION-YEAR DELIMITED BY SIZE
           "|" DELIMITED BY SIZE
           IF-ABOUT-ME DELIMITED BY SPACE
           INTO PROFILE-DATA-STRING
    END-STRING

    *> Validate profile data
    CALL 'PROFILE-VALIDATION' USING PROFILE-DATA-STRING VALIDATION-STATUS VALIDATION-RESPONSE

    IF VALIDATION-STATUS = "Y"
        *> Validation passed, save profile data
        CALL 'PROFILE-STORAGE' USING L-USERNAME PROFILE-DATA-STRING "SAVE" STORAGE-STATUS STORAGE-RESPONSE

        IF STORAGE-STATUS = "Y"
            MOVE "Y" TO L-STATUS
            MOVE "Profile created and saved successfully!" TO L-RESPONSE
        ELSE
            MOVE "Profile validation passed but save failed" TO L-RESPONSE
        END-IF
    ELSE
        *> Validation failed
        MOVE VALIDATION-RESPONSE TO L-RESPONSE
    END-IF

    GOBACK.
